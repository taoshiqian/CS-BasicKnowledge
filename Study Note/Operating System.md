# 操作系统

### 进程与线程

##### 概念

**进程**是资源（CPU，内存等）分配的基本单位，它是程序运行的一个实例。程序运行时系统就会创建一个进程，并为它分配资源，然后把该进程放入进程就绪队列，进程调度器选中它的时候就为它分配CPU时间，程序开始真正运行。

Linux fork：Linux系统函数`fork()`可以在父进程中创建一个子进程，这样的话，在一个进程接到来自客户端新的请求时就可以复制出一个子进程让其来处理，父进程只需负责监控请求的到来，然后创建子进程让其去处理，这样就能做到并发处理。

**线程**是程序执行的最小单位，它是进程的一个执行流，是CPU调度和分派的基本单位，一个进程可以由很多个线程组成，线程间共享进程资源，每个线程有自己的堆栈和局部变量。线程有CPU独立调度执行，在多CPU环境下就允许多个线程同时运行。同样线程也可以实现并发操作，每个请求分配一个线程来处理。

##### 区别

1. 进程是分配资源的最小单位；线程是程序执行的最小单位
2. 进程有自己的独立地址空间，每启动一个进程，系统就会为它分配地址空间，建立数据表来维护代码段、堆栈段和数据段，这种操作消耗较大；而线程则共享进程中的数据，使用相同的地址空间，因此CPU切换一个线程的消耗要比切换进程小很多，创建的消耗也小很多。
3. 线程之间的通信更方便，同一进程下的线程共享全局变量、静态变量等数据；而进程之间需要以通信（IPC）方式进行。不过如何处理好同步与互斥是编写多线程程序的难点。
4. 多进程程序更加健壮，因为每个进程都有自己独立的地址空间；而多线程程序只要一个线程死掉，整个进程也死掉了。

